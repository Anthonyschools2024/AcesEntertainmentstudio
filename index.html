<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ace's Entertainment Studios</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Exo+2:wght@300;400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Exo 2', sans-serif;
            color: #E0E0E0;
            /* The Vanta.js canvas will be injected here */
        }
        #vanta-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .sci-fi-header { font-family: 'Orbitron', sans-serif; }
        .nav-link { @apply px-4 py-2 rounded-md text-lg transition-all duration-300 relative overflow-hidden; border: 1px solid transparent; }
        .nav-link:hover, .nav-link.active { color: #00ffff; border-color: #00ffff; box-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff; background-color: rgba(0, 255, 255, 0.1); }
        .page { display: none; }
        .page.active { display: block; }
        .card { background-color: rgba(10, 25, 47, 0.8); border: 1px solid #38bdf8; border-radius: 8px; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); transition: all 0.3s ease; }
        .card:hover { box-shadow: 0 0 15px rgba(56, 189, 248, 0.5); border-color: #7dd3fc; }
        .btn-primary { @apply font-bold py-2 px-5 rounded-lg transition-all duration-300; background-color: #38bdf8; color: #0a0a14; border: 1px solid #38bdf8; box-shadow: 0 0 5px #38bdf8; }
        .btn-primary:hover { background-color: #7dd3fc; box-shadow: 0 0 10px #38bdf8, 0 0 20px #38bdf8; }
        .btn-primary:disabled { background-color: #4a5568; color: #a0aec0; cursor: not-allowed; box-shadow: none; }
        .input-field { @apply bg-transparent border-b-2 border-cyan-400 w-full py-2 px-1 text-white leading-tight focus:outline-none; transition: border-color 0.3s; }
        .input-field:focus { border-color: #7dd3fc; box-shadow: 0 1px 0 #7dd3fc; }
        .star-wars-title-container { display: flex; justify-content: center; perspective: 400px; }
        .star-wars-title { font-family: 'Orbitron', sans-serif; font-weight: 700; color: #FFE81F; font-size: 5vw; text-align: center; line-height: 1.2; transform: rotateX(20deg); text-shadow: 0px 4px 8px rgba(0,0,0,0.5); }
        input[type="file"]::file-selector-button { @apply font-bold py-2 px-5 rounded-lg transition-all duration-300; background-color: #38bdf8; color: #0a0a14; border: 1px solid #38bdf8; box-shadow: 0 0 5px #38bdf8; cursor: pointer; }
        input[type="file"]::file-selector-button:hover { background-color: #7dd3fc; box-shadow: 0 0 10px #38bdf8, 0 0 20px #38bdf8; }
    </style>
</head>
<body class="bg-black text-cyan-300">
    <div id="vanta-canvas"></div>

    <nav class="bg-black/50 backdrop-blur-lg p-4 sticky top-0 z-40 border-b border-cyan-400/30">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-bold sci-fi-header text-cyan-400">A.E.S.</h1>
            <div class="space-x-4">
                <a href="#" class="nav-link active" data-page="home">Home</a>
                <a href="#" class="nav-link" data-page="about">About</a>
                <a href="#" class="nav-link" data-page="admin">Admin</a>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-4 md:p-8">
        <div id="home" class="page active"><div class="star-wars-title-container my-12 md:my-16"><h1 class="star-wars-title">Ace's Entertainment<br>Studios</h1></div><h2 class="text-4xl font-bold mb-8 text-center sci-fi-header text-cyan-400 tracking-wider">Upcoming Transmissions</h2><div id="event-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div><div id="signup-form-container" class="hidden mt-12"></div></div>
        <div id="about" class="page"><div class="card p-8"><h2 class="text-4xl font-bold mb-6 sci-fi-header text-cyan-400">About A.E.S.</h2><p class="text-lg leading-relaxed mb-4 text-gray-300">Welcome to Ace's Entertainment Studios, the galaxy's premier event management powerhouse...</p></div><div class="card p-8 mt-8"><h3 class="text-3xl font-bold mb-6 sci-fi-header text-cyan-400">About The CEO</h3><div class="flex flex-col md:flex-row gap-8 items-center"><div class="md:w-1/3 flex-shrink-0"><img id="ceo-profile-pic" src="" alt="CEO Photo" class="rounded-lg border-2 border-cyan-400 shadow-lg shadow-cyan-400/20 w-full h-auto object-cover"></div><div class="md:w-2/3"><p class="text-lg leading-relaxed text-gray-300">Hello, my name is Anthony Tyler Kimble...<br><br>My core mission is to use the power of entertainment to highlight the political challenges we face...</p></div></div></div></div>
        <div id="admin" class="page"></div>
    </main>

    <div id="admin-login-modal" class="fixed inset-0 z-50 items-center justify-center hidden" style="background-color: rgba(0,0,0,0.8); backdrop-filter: blur(5px);"><div class="bg-gray-900/80 p-8 rounded-lg shadow-2xl border border-cyan-400 max-w-sm mx-auto"><h3 class="text-2xl font-bold mb-6 text-center sci-fi-header text-cyan-400">Admin Access Protocol</h3><form id="admin-login-form"><div class="mb-4"><label for="username" class="block text-cyan-400 text-sm font-bold mb-2">Username:</label><input type="text" id="username" class="input-field" required></div><div class="mb-4"><label for="password" class="block text-cyan-400 text-sm font-bold mb-2">Password:</label><input type="password" id="password" class="input-field" required></div><button type="submit" class="btn-primary w-full mt-4">Authorize</button><p id="login-error" class="text-red-500 text-center mt-4 h-4"></p></form></div></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.fog.min.js"></script>

    <script type="module">
        // --- 3D Background Initialization ---
        VANTA.FOG({
          el: "#vanta-canvas",
          mouseControls: true,
          touchControls: true,
          gyroControls: false,
          minHeight: 200.00,
          minWidth: 200.00,
          highlightColor: 0x235a69,
          midtoneColor: 0x4f4f93,
          lowlightColor: 0x14143a,
          baseColor: 0x0a0a14,
          blurFactor: 0.5,
          speed: 0.5,
          zoom: 0.6
        });

        // --- Global State & API ---
        const API_URL = '';
        let currentEventId = null;

        // --- Auth Helpers ---
        const saveToken = (token) => localStorage.setItem('aes_jwt', token);
        const getToken = () => localStorage.getItem('aes_jwt');
        const logout = () => { localStorage.removeItem('aes_jwt'); location.reload(); };
        const authFetch = async (url, options = {}) => {
            const headers = new Headers(options.headers || {});
            const token = getToken();
            if (token) headers.set('Authorization', `Bearer ${token}`);
            // Note: For file uploads, we don't set Content-Type, the browser does.
            if (!(options.body instanceof FormData)) {
                headers.set('Content-Type', 'application/json');
            }
            const res = await fetch(url, { ...options, headers });
            if (res.status === 401) logout();
            return res;
        };

        // --- Page Navigation ---
        const navLinks = document.querySelectorAll('.nav-link');
        const pages = document.querySelectorAll('.page');
        const adminLoginModal = document.getElementById('admin-login-modal');

        function showPage(pageId) {
            if (pageId === 'admin' && !getToken()) {
                adminLoginModal.style.display = 'flex';
                return;
            }
            pages.forEach(p => p.classList.toggle('active', p.id === pageId));
            navLinks.forEach(l => l.classList.toggle('active', l.dataset.page === pageId));
            adminLoginModal.style.display = 'none';
            if (pageId === 'admin') renderAdminPage();
        }

        navLinks.forEach(link => link.addEventListener('click', e => { e.preventDefault(); showPage(link.dataset.page); }));

        // --- Admin Login ---
        document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const res = await fetch(`${API_URL}/api/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: e.target.username.value, password: e.target.password.value })
            });
            if (res.ok) {
                const { token } = await res.json();
                saveToken(token);
                showPage('admin');
            } else {
                document.getElementById('login-error').textContent = 'Authorization failed.';
            }
        });

        // --- Event Rendering ---
        const eventList = document.getElementById('event-list');
        async function loadEvents() {
            const res = await fetch(`${API_URL}/api/events`);
            const events = await res.json();
            eventList.innerHTML = '';
            events.forEach(event => {
                const card = document.createElement('div');
                card.className = 'card p-6 flex flex-col justify-between';
                card.innerHTML = `
                    <div>
                        ${event.posterUrl ? `<img src="${event.posterUrl}" alt="${event.name} Poster" class="w-full h-48 object-cover rounded-md mb-4 border border-cyan-400/20">` : ''}
                        <h3 class="text-2xl font-bold mb-2 sci-fi-header text-cyan-400">${event.name}</h3>
                        <p class="text-cyan-200 mb-2">${new Date(event.date).toLocaleDateString()}</p>
                        <p class="mb-4 text-gray-300">${event.description}</p>
                    </div>
                    <button class="btn-primary self-start signup-btn mt-4" data-event-id="${event.id}" data-event-name="${event.name}">Register Signal</button>
                `;
                eventList.appendChild(card);
            });
        }
        eventList.addEventListener('click', e => {
            if (e.target.classList.contains('signup-btn')) {
                currentEventId = e.target.dataset.eventId;
                showSignupForm({ name: e.target.dataset.eventName });
            }
        });
        
        // --- Signup Form ---
        const signupFormContainer = document.getElementById('signup-form-container');
        function showSignupForm(event) {
            signupFormContainer.innerHTML = `<div class="card p-8 max-w-3xl mx-auto"><h3 class="text-3xl font-bold mb-6 text-center sci-fi-header text-cyan-400">Register for ${event.name}</h3><form id="artist-signup-form"><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4"><div class="mb-4"><label class="block text-cyan-400 text-sm font-bold mb-2">Artist/Unit Designation:</label><input type="text" id="artistName" class="input-field" required></div><div class="mb-4"><label class="block text-cyan-400 text-sm font-bold mb-2">Comlink Frequency (Email):</label><input type="email" id="contactEmail" class="input-field" required></div></div><div class="mb-4"><label class="block text-cyan-400 text-sm font-bold mb-2">Performance Protocol:</label><input type="text" id="genre" class="input-field" required></div><div class="mb-4"><label class="block text-cyan-400 text-sm font-bold mb-2">Artist Description (Max 1500 chars):</label><textarea id="description" class="input-field h-32" maxlength="1500"></textarea></div><div class="mb-6"><label class="block text-cyan-400 text-sm font-bold mb-2">Promo Photo URLs:</label><input type="text" id="promoPhotos" class="input-field" placeholder="https://.../img1.jpg, https://.../img2.jpg"></div><div class="flex items-center justify-between mt-6"><button type="submit" class="btn-primary">Transmit Application</button><button type="button" id="cancel-signup" class="text-gray-400 hover:text-white px-4 py-2 rounded-md">Cancel</button></div></form></div>`;
            signupFormContainer.classList.remove('hidden');
            eventList.classList.add('hidden');
            document.getElementById('cancel-signup').addEventListener('click', () => { signupFormContainer.classList.add('hidden'); eventList.classList.remove('hidden'); });
            document.getElementById('artist-signup-form').addEventListener('submit', handleSignupSubmit);
        }

        async function handleSignupSubmit(e) {
            e.preventDefault();
            const signupData = { eventId: currentEventId, artistName: e.target.artistName.value, contactEmail: e.target.contactEmail.value, genre: e.target.genre.value, description: e.target.description.value, promoPhotos: e.target.promoPhotos.value };
            const res = await fetch(`${API_URL}/api/signups`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(signupData) });
            if (res.ok) {
                showCustomAlert('Signal Received! Application under review.', 'success');
                signupFormContainer.classList.add('hidden'); eventList.classList.remove('hidden');
            } else { showCustomAlert('Error: Transmission failed.', 'error'); }
        }

        // --- Admin Page Rendering ---
        const adminPageContainer = document.getElementById('admin');
        async function renderAdminPage() {
            adminPageContainer.innerHTML = `<div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="flex flex-col gap-8"><div class="card p-8"><h3 class="text-3xl font-bold mb-6 sci-fi-header text-cyan-400">Broadcast New Event</h3><form id="add-event-form"><div class="mb-4"><label class="block text-cyan-400 text-sm font-bold mb-2">Event Designation:</label><input type="text" name="name" class="input-field" required></div><div class="mb-4"><label class="block text-cyan-400 text-sm font-bold mb-2">Event Date:</label><input type="date" name="date" class="input-field" required style="color-scheme: dark;"></div><div class="mb-4"><label class="block text-cyan-400 text-sm font-bold mb-2">Details:</label><textarea name="description" rows="4" class="input-field" required></textarea></div><div class="mb-6"><label class="block text-cyan-400 text-sm font-bold mb-2">Event Poster:</label><input type="file" name="poster" class="w-full text-sm text-slate-500" accept="image/png, image/jpeg" required></div><button type="submit" class="btn-primary mt-4">Broadcast</button></form></div></div><div class="card p-8"><h3 class="text-3xl font-bold mb-6 sci-fi-header text-cyan-400">Incoming Signals</h3><div id="signups-list" class="space-y-4 max-h-[40rem] overflow-y-auto pr-2"></div></div></div>`;
            document.getElementById('add-event-form').addEventListener('submit', handleAddEvent);
            const res = await authFetch(`${API_URL}/api/admin/signups`);
            const signups = await res.json();
            const signupsList = document.getElementById('signups-list');
            signupsList.innerHTML = !signups.length ? '<p>No signals received.</p>' : '';
            signups.forEach(s => {
                const el = document.createElement('div');
                el.className = 'p-4 bg-black/30 rounded border border-cyan-400/20';
                el.innerHTML = `<p><strong>Designation:</strong> ${s.artistName}</p><p><strong>Comlink:</strong> ${s.contactEmail}</p><p><strong>Description:</strong> ${s.description || 'N/A'}</p><p><strong>Photos:</strong> ${s.promoPhotos || 'N/A'}</p>`;
                signupsList.appendChild(el);
            });
        }

        async function handleAddEvent(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const res = await authFetch(`${API_URL}/api/admin/events`, { method: 'POST', body: formData });
            if (res.ok) {
                showCustomAlert('Event Broadcasted!', 'success');
                e.target.reset();
                loadEvents();
            } else { showCustomAlert('Broadcast Failed.', 'error'); }
        }

        async function loadCeoPhoto() {
            const res = await fetch(`${API_URL}/api/config/site`);
            const data = await res.json();
            if (data.ceoPhotoUrl) { document.getElementById('ceo-profile-pic').src = data.ceoPhotoUrl; }
        }
        
        function showCustomAlert(message, type = 'success') { /* ... existing alert logic ... */ }

        // --- Initial Load ---
        function initializeApp() { loadEvents(); loadCeoPhoto(); showPage('home'); }
        initializeApp();
    </script>
</body>
</html>
